{"version":3,"sources":["../src/image_editable.js"],"names":["selectors","actions","confirm","cancel","cropimage","uploadimage","deleteimage","regions","imagehandler","imagecontrols","alert","zoomslider","editactions","confirmactions","spinner","hiddenFormField","classes","hidden","saving","deleting","disabled","enabled","humanFileSize","size","i","Math","floor","log","pow","toFixed","showImageAlert","target","msg","Templates","render","message","closebutton","iswarning","then","html","js","prependNodeContents","removeImageAlert","querySelector","remove","showSpinner","show","classList","add","showDeleteOption","setAttribute","showEditActions","currentimage","getAttribute","updateImage","args","promise","Ajax","call","methodname","fail","Notification","exception","setBackgroundImage","imageHandler","imageUrl","style","backgroundImage","confirmAction","string","action","newconfirm","cloneNode","parentNode","replaceChild","done","str","innerHTML","addEventListener","e","preventDefault","cancelAction","newcancel","imageCropper","currentImage","croppedImage","Croppie","enableExif","viewport","width","height","type","bind","url","result","imageData","ajaxParams","imagedata","split","imagefilename","cropped","component","filearea","contextid","draftitemid","params","success","destroy","warning","catch","imageUploader","siteMaxBytes","event","file","files","match","backupImage","reader","FileReader","onload","filedata","maxbytesstr","name","img","document","createElement","naturalWidth","fileurl","value","readAsDataURL","imageDelete","contains","defaultImage","init"],"mappings":"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","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   image_editable\n * @copyright 2021 Bas Brands\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Croppie from 'local_editimage/croppie';\nimport {get_string as getString} from 'core/str';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nconst selectors = {\n    actions: {\n        confirm: '[data-action=\"confirm\"]',\n        cancel: '[data-action=\"cancel\"]',\n        cropimage: '[data-action=\"cropimage\"]',\n        uploadimage: '[data-action=\"uploadimage\"]',\n        deleteimage: '[data-action=\"deleteimage\"]'\n    },\n    regions: {\n        imagehandler: '[data-region=\"imagehandler\"]',\n        imagecontrols: '[data-region=\"imagecontrols\"]',\n        alert: '.alert',\n        zoomslider: '.cr-slider',\n        editactions: '[data-region=\"editactions\"]',\n        confirmactions: '[data-region=\"confirmactions\"]',\n        spinner: '[data-region=\"spinner\"]',\n        hiddenFormField: '[data-region=\"hiddenformfield\"]'\n    },\n    classes: {\n        hidden: 'd-none',\n        saving: 'saving',\n        deleting: 'deleting',\n        disabled: 'disabled',\n        enabled: 'js-enabled'\n    }\n};\n/**\n * Get human file size from bytes.\n *\n * @param {Int} size\n * @returns {string} the human readable size string\n */\n export const humanFileSize = size => {\n    const i = Math.floor(Math.log(size) / Math.log(1024));\n    return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];\n};\n/**\n * Show an alert on the image.\n * @param  {HTMLElement} target DOM node of the editable image\n * @param  {String} msg Message to show in the alert\n * @return {Promise} Template promise.\n */\nconst showImageAlert = (target, msg) => {\n    return Templates.render('core/notification', {\n        message: msg,\n        closebutton: true,\n        iswarning: true\n    }).then((html, js) => {\n        Templates.prependNodeContents(target, html, js);\n        return;\n    });\n};\n\n/**\n * Remove the image alert.\n * @param {HTMLElement} target DOM node of the editable image\n */\nconst removeImageAlert = target => {\n    const alert = target.querySelector(selectors.regions.alert);\n    if (alert) {\n        alert.remove();\n    }\n};\n\n/**\n * Show the spinner.\n * @param  {HTMLElement} target DOM node of the editable image\n * @param  {Bool} show\n */\nconst showSpinner = (target, show) => {\n    const spinner = target.querySelector(selectors.regions.spinner);\n    if (show) {\n        spinner.classList.remove(selectors.classes.hidden);\n    } else {\n        spinner.classList.add(selectors.classes.hidden);\n    }\n};\n\n/**\n * Show delete option\n * @param  {HTMLElement} target DOM node of the editable image\n * @param  {Bool} show\n */\n const showDeleteOption = (target, show) => {\n    const deleteimage = target.querySelector(selectors.actions.deleteimage);\n    if (show) {\n        deleteimage.classList.add(selectors.classes.enabled);\n        deleteimage.setAttribute('tabindex', 0);\n    } else {\n        deleteimage.classList.remove(selectors.classes.enabled);\n        deleteimage.setAttribute('tabindex', -1);\n    }\n };\n\n/**\n * Show the edit actions upload image and crop image, this hides\n * the confirm actions.\n * @param  {HTMLElement} target DOM node of the editable image\n */\nconst showEditActions = target => {\n    const currentimage = target.getAttribute('data-currentimage');\n    const cropimage = target.querySelector(selectors.actions.cropimage);\n    const confirmactions = target.querySelector(selectors.regions.confirmactions);\n    const editactions = target.querySelector(selectors.regions.editactions);\n    if (currentimage) {\n        cropimage.classList.remove(selectors.classes.hidden);\n        showDeleteOption(target, true);\n    } else {\n        cropimage.classList.add(selectors.classes.hidden);\n        showDeleteOption(target, false);\n    }\n    confirmactions.classList.add(selectors.classes.hidden);\n    editactions.classList.remove(selectors.classes.hidden);\n    removeImageAlert(target);\n};\n\n/**\n * Save an image from the image handler\n * @param {Object} args The request arguments\n * @return {Promise} Resolved with an array file the stored file url.\n */\nconst updateImage = args => {\n    const request = {\n        methodname: 'local_editimge_imageeditable_update_image',\n        args: args\n    };\n\n    let promise = Ajax.call([request])[0]\n        .fail(Notification.exception);\n\n    return promise;\n};\n\n/**\n * Set the background image\n * @param {HTMLElement} imageHandler DOM node of the editable image\n * @param {String} imageUrl the new background image url or data.\n */\nconst setBackgroundImage = (imageHandler, imageUrl) => {\n    imageHandler.style.backgroundImage = 'url(\"' + imageUrl + '\")';\n};\n\n/**\n * Show the confirm actions, this hides the edit actions.\n * @param {HTMLElement} target DOM node of the editable image wrapper\n * @param {Promise} string promise to show on confirm button.\n * @param {function} action to execute.\n */\nconst confirmAction = (target, string, action) => {\n    const confirmactions = target.querySelector(selectors.regions.confirmactions);\n    const editactions = target.querySelector(selectors.regions.editactions);\n    const confirm = target.querySelector(selectors.actions.confirm);\n\n    // Create a new button to remove all old event listeners.\n    const newconfirm = confirm.cloneNode(true);\n    confirm.parentNode.replaceChild(newconfirm, confirm);\n\n    string.done(str => {\n        newconfirm.innerHTML = str;\n\n        confirmactions.classList.remove(selectors.classes.hidden);\n        editactions.classList.add(selectors.classes.hidden);\n\n        newconfirm.addEventListener('click', e => {\n            action();\n            e.preventDefault();\n        });\n    });\n    showDeleteOption(target, false);\n};\n\n/**\n * Show the cancel actions.\n * @param {HTMLElement} target DOM node of the editable image wrapper\n * @param {function} action callback to execute.\n */\nconst cancelAction = (target, action) => {\n    let cancel = target.querySelector(selectors.actions.cancel);\n\n    // Create a new button to remove all old event listeners.\n    const newcancel = cancel.cloneNode(true);\n    cancel.parentNode.replaceChild(newcancel, cancel);\n\n    newcancel.addEventListener('click', e => {\n        action();\n        e.preventDefault();\n    });\n};\n\n/**\n * Crop the current image.\n * @param {HTMLElement} target DOM node of the editable image wrapper.\n */\nconst imageCropper = target => {\n    const imageHandler = target.querySelector(selectors.regions.imagehandler);\n\n    let currentImage = target.getAttribute('data-currentimage');\n\n    const size = target.getAttribute('data-size');\n\n    const croppedImage = new Croppie(imageHandler, {\n        enableExif: true,\n        viewport: {\n            width: (size / 100) * (90),\n            height: (size / 100) * (90),\n            type: 'square'\n        }\n    });\n    croppedImage.bind({\n        url: currentImage,\n    });\n\n    setBackgroundImage(imageHandler, '');\n\n    const zoomslider = target.querySelector(selectors.regions.zoomslider);\n    zoomslider.classList.add('form-control-range');\n    // Increase the slider step size so it is keyboard accessible.\n    zoomslider.setAttribute('step', 0.01);\n\n    // Makes the viewport look like a circle\n    if (target.getAttribute('data-rounded') === 'rounded') {\n        target.querySelector('.cr-viewport').classList.add('cr-vp-circle');\n    }\n\n    confirmAction(target, getString('cropimage', 'local_editimage'), () => {\n        croppedImage.result('base64').then(imageData => {\n\n            let ajaxParams = {\n                imagedata: imageData.split('base64,')[1],\n                imagefilename: 'cropped.png',\n                cropped: 1,\n                component: target.getAttribute('data-component'),\n                filearea: target.getAttribute('data-filearea'),\n                contextid: target.getAttribute('data-contextid'),\n                draftitemid: target.getAttribute('data-draftitemid')\n            };\n\n            showSpinner(target, true);\n\n            updateImage({params: ajaxParams}).then(result => {\n                if (result.success) {\n                    setBackgroundImage(imageHandler, imageData);\n                    croppedImage.destroy();\n                }\n                if (result.warning) {\n                    showImageAlert(imageHandler, result.warning, 'warning');\n                }\n                showSpinner(target, false);\n                showEditActions(target);\n                return;\n            }).catch(Notification.exception);\n            return;\n        }).catch(Notification.exception);\n    });\n\n    cancelAction(target, () => {\n        croppedImage.destroy();\n        setBackgroundImage(imageHandler, currentImage);\n        showEditActions(target);\n    });\n};\n\n/**\n * Upload a new image.\n * @param {HTMLElement} target DOM node of the editable image wrapper.\n * @param {Int} siteMaxBytes the maximum size for these images.\n * @param {Event} event the event listener event.\n */\nconst imageUploader = (target, siteMaxBytes, event) => {\n    const imageHandler = target.querySelector(selectors.regions.imagehandler);\n\n    const hiddenFormField = target.querySelector(selectors.regions.hiddenFormField);\n\n    let file = event.target.files[0];\n\n    // Only process image files.\n    if (!file.type.match('image.*')) {\n        return;\n    }\n\n    let backupImage = target.getAttribute('data-currentimage');\n\n    if (backupImage === '') {\n        backupImage = target.getAttribute('data-defaultimage');\n    }\n\n    var reader = new FileReader();\n    reader.onload = (() => {\n        let filedata = reader.result;\n\n        if (file.size > siteMaxBytes) {\n            const maxbytesstr = {\n                size: humanFileSize(siteMaxBytes),\n                file: file.name\n            };\n            getString('maxbytesfile', 'error', maxbytesstr).done(message => {\n                showImageAlert(imageHandler, message);\n            });\n            return;\n        }\n\n        // Warn if image resolution is too small.\n        let img = document.createElement('img');\n        img.setAttribute('src', filedata);\n        img.addEventListener('load', () => {\n            if (img.naturalWidth < 512) {\n                getString('resolutionlow', 'local_editimage').done(message => {\n                    showImageAlert(imageHandler, message);\n                });\n            }\n        });\n        setBackgroundImage(imageHandler, filedata);\n\n        let ajaxParams = {\n            imagefilename: file.name,\n            imagedata: filedata.split('base64,')[1],\n            cropped: 0,\n            component: target.getAttribute('data-component'),\n            filearea: target.getAttribute('data-filearea'),\n            contextid: target.getAttribute('data-contextid'),\n            draftitemid: target.getAttribute('data-draftitemid')\n        };\n\n        confirmAction(target, getString('save', 'admin'), () => {\n            showSpinner(target, true);\n            updateImage({params: ajaxParams}).then(result => {\n                if (result.success) {\n                    target.setAttribute('data-currentimage', result.fileurl);\n                    backupImage = result.fileurl;\n                }\n                if (result.warning) {\n                    showImageAlert(imageHandler, result.warning, 'warning');\n                }\n                if (hiddenFormField) {\n                    hiddenFormField.value = ajaxParams.draftitemid;\n                }\n                showSpinner(target, false);\n                showEditActions(target);\n                return;\n            }).catch(Notification.exception);\n        });\n        cancelAction(target, () => {\n            setBackgroundImage(imageHandler, backupImage);\n            showEditActions(target);\n        });\n    });\n    // Read in the image file as a data URL.\n    reader.readAsDataURL(file);\n};\n\n/**\n * Delete the image.\n *\n * @param {HTMLElement} target DOM node of the editable image wrapper.\n * @returns {String} empty\n */\nconst imageDelete = target => {\n    const deleteimage = target.querySelector(selectors.actions.deleteimage);\n\n    const hiddenFormField = target.querySelector(selectors.regions.hiddenFormField);\n\n    if (!deleteimage.classList.contains(selectors.classes.enabled)) {\n        return '';\n    }\n\n    const defaultImage = target.getAttribute('data-defaultimage');\n\n    const imageHandler = target.querySelector(selectors.regions.imagehandler);\n\n    let ajaxParams = {\n        imagedata: '',\n        imagefilename: '',\n        cropped: 0,\n        component: target.getAttribute('data-component'),\n        filearea: target.getAttribute('data-filearea'),\n        contextid: target.getAttribute('data-contextid'),\n        draftitemid: target.getAttribute('data-draftitemid'),\n        'delete': 1,\n    };\n\n    confirmAction(target, getString('delete', 'moodle'), () => {\n        showSpinner(target, true);\n        updateImage({params: ajaxParams}).then(result => {\n            if (result.success) {\n                setBackgroundImage(imageHandler, defaultImage);\n                target.setAttribute('data-currentimage', '');\n            }\n            if (hiddenFormField) {\n                hiddenFormField.value = -1;\n            }\n            showSpinner(target, false);\n            showEditActions(target);\n            return '';\n        }).catch(Notification.exception);\n    });\n\n    cancelAction(target, () => {\n        showEditActions(target);\n    });\n    return '';\n};\n\n/**\n * Initiate the editable image controls.\n *\n * @param {HTMLElement} target DOM node of the editable image\n * @param {int} siteMaxBytes\n */\nexport const init = (target, siteMaxBytes) => {\n    const cropimage = target.querySelector(selectors.actions.cropimage);\n    const uploadimage = target.querySelector(selectors.actions.uploadimage);\n    const deleteimage = target.querySelector(selectors.actions.deleteimage);\n    const imagecontrols = target.querySelector(selectors.regions.imagecontrols);\n\n    // Actions on cropping\n    cropimage.addEventListener('click', e => {\n        imageCropper(target);\n        e.preventDefault();\n    });\n\n    // Process the uploaded file\n    uploadimage.addEventListener('change', e => {\n        imageUploader(target, siteMaxBytes, e);\n        e.preventDefault();\n    });\n\n    // Delete the shown image.\n    deleteimage.addEventListener('click', e => {\n        imageDelete(target);\n        e.preventDefault();\n    });\n\n    showEditActions(target);\n    imagecontrols.classList.add('js-enabled');\n};\n"],"file":"image_editable.min.js"}